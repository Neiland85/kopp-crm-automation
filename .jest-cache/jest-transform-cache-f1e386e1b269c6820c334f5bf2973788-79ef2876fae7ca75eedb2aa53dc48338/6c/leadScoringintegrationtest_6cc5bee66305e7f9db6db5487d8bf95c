0a7948f94d105ed5ffc8bd4250173ceb
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock del logger
jest.mock('fs/promises');
const index_1 = __importDefault(require("../src/zapier/index"));
const common_1 = require("../src/zapier/utils/common");
// Helper para crear mock bundle
const createMockBundle = (overrides = {}) => ({
    authData: {
        hubspot_api_key: 'test-hubspot-api-key',
        slack_webhook_url: 'https://hooks.slack.com/services/test/webhook/url',
    },
    inputData: {},
    cleanedRequest: {},
    rawRequest: {},
    ...overrides,
});
// Mock del objeto z (Zapier)
const createMockZ = () => ({
    console: {
        log: jest.fn(),
        error: jest.fn(),
        warn: jest.fn(),
    },
    errors: {
        Error: Error,
        RefreshAuthError: Error,
        HaltedError: Error,
    },
    request: jest.fn(),
    JSON: {
        parse: JSON.parse,
        stringify: JSON.stringify,
    },
    cursor: {
        get: jest.fn().mockReturnValue(null),
        store: jest.fn(),
    },
});
describe('Lead Scoring Integration Tests', () => {
    let mockZ;
    beforeEach(() => {
        mockZ = createMockZ();
        jest.clearAllMocks();
    });
    describe('Updated Contact Property Trigger', () => {
        test('should detect contacts with updated lead_score', async () => {
            // Mock de respuesta de HubSpot API
            const mockContactsResponse = {
                status: 200,
                data: {
                    results: [
                        {
                            id: 'contact-123',
                            properties: {
                                email: 'john.doe@example.com',
                                firstname: 'John',
                                lastname: 'Doe',
                                lead_score: '75',
                                last_score_update: '2024-01-15T09:00:00Z',
                                hs_lastmodifieddate: '2024-01-15T10:30:00Z',
                                company: 'Example Corp',
                                phone: '+1234567890',
                            },
                        },
                        {
                            id: 'contact-456',
                            properties: {
                                email: 'jane.smith@example.com',
                                firstname: 'Jane',
                                lastname: 'Smith',
                                lead_score: '45',
                                last_score_update: '2024-01-15T11:00:00Z',
                                hs_lastmodifieddate: '2024-01-15T10:30:00Z', // Older than last_score_update
                                company: 'Test Corp',
                            },
                        },
                    ],
                },
            };
            mockZ.request.mockResolvedValue(mockContactsResponse);
            const bundle = createMockBundle();
            const trigger = index_1.default.triggers.updated_contact_property;
            const results = await trigger.operation.perform(mockZ, bundle);
            expect(results).toBeDefined();
            expect(Array.isArray(results)).toBe(true);
            // Solo deberÃ­a retornar contact-123 porque su score fue actualizado despuÃ©s de last_score_update
            expect(results.length).toBe(1);
            expect(results[0]).toMatchObject({
                id: 'contact-123',
                email: 'john.doe@example.com',
                lead_score: 75,
                firstname: 'John',
                lastname: 'Doe',
            });
            expect(mockZ.request).toHaveBeenCalledWith(expect.objectContaining({
                url: 'https://api.hubapi.com/crm/v3/objects/contacts/search',
                method: 'POST',
                headers: expect.objectContaining({
                    Authorization: 'Bearer test-hubspot-api-key',
                }),
            }));
        });
        test('should handle empty results gracefully', async () => {
            mockZ.request.mockResolvedValue({
                status: 200,
                data: { results: [] },
            });
            const bundle = createMockBundle();
            const trigger = index_1.default.triggers.updated_contact_property;
            const results = await trigger.operation.perform(mockZ, bundle);
            expect(results).toEqual([]);
        });
        test('should retry on network failures', async () => {
            mockZ.request
                .mockRejectedValueOnce(new Error('Network timeout'))
                .mockRejectedValueOnce(new Error('Connection refused'))
                .mockResolvedValue({
                status: 200,
                data: { results: [] },
            });
            const bundle = createMockBundle();
            const trigger = index_1.default.triggers.updated_contact_property;
            const results = await trigger.operation.perform(mockZ, bundle);
            expect(results).toEqual([]);
            expect(mockZ.request).toHaveBeenCalledTimes(3); // 1 initial + 2 retries
        });
    });
    describe('Update Score Timestamp Create Action', () => {
        test('should update last_score_update timestamp', async () => {
            const mockUpdateResponse = {
                status: 200,
                data: {
                    id: 'contact-123',
                    properties: {
                        email: 'john.doe@example.com',
                        lead_score: '75',
                        last_score_update: '2024-01-15T12:00:00Z',
                    },
                },
            };
            mockZ.request.mockResolvedValue(mockUpdateResponse);
            const bundle = createMockBundle({
                inputData: {
                    contact_id: 'contact-123',
                    email: 'john.doe@example.com',
                    lead_score: 75,
                },
            });
            const create = index_1.default.creates.update_score_timestamp;
            const result = await create.operation.perform(mockZ, bundle);
            expect(result).toMatchObject({
                contact_id: 'contact-123',
                email: 'john.doe@example.com',
                lead_score: 75,
                updated_properties: expect.arrayContaining([
                    'last_score_update',
                    'lead_score',
                ]),
            });
            expect(mockZ.request).toHaveBeenCalledWith(expect.objectContaining({
                url: 'https://api.hubapi.com/crm/v3/objects/contacts/contact-123',
                method: 'PATCH',
                json: expect.objectContaining({
                    properties: expect.objectContaining({
                        last_score_update: expect.any(String),
                    }),
                }),
            }));
        });
        test('should fail without contact_id', async () => {
            const bundle = createMockBundle({
                inputData: {
                    email: 'john.doe@example.com',
                    lead_score: 75,
                },
            });
            const create = index_1.default.creates.update_score_timestamp;
            await expect(create.operation.perform(mockZ, bundle)).rejects.toThrow('Contact ID is required');
        });
    });
    describe('Send Scoring Notification Create Action', () => {
        test('should send notification for score >= 50', async () => {
            const mockSlackResponse = {
                status: 200,
                data: { ok: true },
            };
            mockZ.request.mockResolvedValue(mockSlackResponse);
            const bundle = createMockBundle({
                inputData: {
                    email: 'john.doe@example.com',
                    lead_score: 75,
                    firstname: 'John',
                    lastname: 'Doe',
                    company: 'Example Corp',
                    contact_id: 'contact-123',
                },
            });
            const create = index_1.default.creates.send_scoring_notification;
            const result = await create.operation.perform(mockZ, bundle);
            expect(result.blocks).toBeDefined();
            expect(result.blocks.length).toBeGreaterThan(0);
            expect(result.channel).toBe('#scoring-leads');
            // Verificar estructura del mensaje
            expect(result.blocks[0]).toMatchObject({
                type: 'section',
                text: {
                    type: 'mrkdwn',
                    text: 'ðŸ“ˆ *Lead Score Actualizado*',
                },
            });
            expect(result.blocks[1].fields).toEqual(expect.arrayContaining([
                expect.objectContaining({
                    text: expect.stringContaining('john.doe@example.com'),
                }),
                expect.objectContaining({
                    text: expect.stringContaining('75'),
                }),
            ]));
            expect(mockZ.request).toHaveBeenCalledWith(expect.objectContaining({
                url: 'https://hooks.slack.com/services/test/webhook/url',
                method: 'POST',
                json: expect.objectContaining({
                    blocks: expect.any(Array),
                    channel: '#scoring-leads',
                }),
            }));
        });
        test('should skip notification for score < 50', async () => {
            const bundle = createMockBundle({
                inputData: {
                    email: 'john.doe@example.com',
                    lead_score: 35,
                    firstname: 'John',
                    lastname: 'Doe',
                },
            });
            const create = index_1.default.creates.send_scoring_notification;
            const result = (await create.operation.perform(mockZ, bundle));
            expect(result.skipped).toBe(true);
            expect(result.reason).toContain('below threshold');
            expect(mockZ.request).not.toHaveBeenCalled();
        });
        test('should include score level for high scores', async () => {
            const mockSlackResponse = {
                status: 200,
                data: { ok: true },
            };
            mockZ.request.mockResolvedValue(mockSlackResponse);
            const bundle = createMockBundle({
                inputData: {
                    email: 'hot.lead@example.com',
                    lead_score: 85,
                    firstname: 'Hot',
                    lastname: 'Lead',
                },
            });
            const create = index_1.default.creates.send_scoring_notification;
            const result = await create.operation.perform(mockZ, bundle);
            // Buscar el bloque que contiene "HOT LEAD"
            const scoreBlock = result.blocks.find((block) => block.text?.text?.includes('ðŸ”¥ *HOT LEAD*'));
            expect(scoreBlock).toBeDefined();
        });
        test('should retry on Slack API failures', async () => {
            mockZ.request
                .mockRejectedValueOnce(new Error('Slack API timeout'))
                .mockRejectedValueOnce(new Error('Service unavailable'))
                .mockResolvedValue({
                status: 200,
                data: { ok: true },
            });
            const bundle = createMockBundle({
                inputData: {
                    email: 'test@example.com',
                    lead_score: 60,
                },
            });
            const create = index_1.default.creates.send_scoring_notification;
            const result = await create.operation.perform(mockZ, bundle);
            expect(result.blocks).toBeDefined();
            expect(mockZ.request).toHaveBeenCalledTimes(3);
        });
    });
    describe('Integration Workflow Tests', () => {
        test('should complete full lead scoring workflow', async () => {
            // Mock responses for the complete workflow
            const mockSearchResponse = {
                status: 200,
                data: {
                    results: [
                        {
                            id: 'contact-123',
                            properties: {
                                email: 'workflow@example.com',
                                firstname: 'Workflow',
                                lastname: 'Test',
                                lead_score: '65',
                                last_score_update: '2024-01-15T09:00:00Z',
                                hs_lastmodifieddate: '2024-01-15T10:30:00Z',
                                company: 'Test Company',
                            },
                        },
                    ],
                },
            };
            const mockUpdateResponse = {
                status: 200,
                data: {
                    id: 'contact-123',
                    properties: {
                        email: 'workflow@example.com',
                        lead_score: '65',
                        last_score_update: '2024-01-15T12:00:00Z',
                    },
                },
            };
            const mockSlackResponse = {
                status: 200,
                data: { ok: true },
            };
            // Step 1: Trigger - Get updated contacts
            mockZ.request.mockResolvedValueOnce(mockSearchResponse);
            const bundle = createMockBundle();
            const trigger = index_1.default.triggers.updated_contact_property;
            const contacts = await trigger.operation.perform(mockZ, bundle);
            expect(contacts.length).toBe(1);
            const contact = contacts[0];
            // Step 2: Update timestamp
            mockZ.request.mockResolvedValueOnce(mockUpdateResponse);
            const updateBundle = createMockBundle({
                inputData: {
                    contact_id: contact.id,
                    email: contact.email,
                    lead_score: contact.lead_score,
                },
            });
            const updateCreate = index_1.default.creates.update_score_timestamp;
            const updateResult = await updateCreate.operation.perform(mockZ, updateBundle);
            expect(updateResult.contact_id).toBe('contact-123');
            // Step 3: Send notification (score >= 50)
            mockZ.request.mockResolvedValueOnce(mockSlackResponse);
            const notificationBundle = createMockBundle({
                inputData: {
                    email: contact.email,
                    lead_score: contact.lead_score,
                    firstname: contact.firstname,
                    lastname: contact.lastname,
                    company: contact.company,
                    contact_id: contact.id,
                },
            });
            const notificationCreate = index_1.default.creates.send_scoring_notification;
            const notificationResult = await notificationCreate.operation.perform(mockZ, notificationBundle);
            expect(notificationResult.blocks).toBeDefined();
            expect(notificationResult.channel).toBe('#scoring-leads');
            // Verify all API calls were made
            expect(mockZ.request).toHaveBeenCalledTimes(3);
        });
    });
    describe('Utility Function Tests', () => {
        test('withRetry should handle exponential backoff', async () => {
            const startTime = Date.now();
            let attempts = 0;
            const failingOperation = jest.fn(async () => {
                attempts++;
                if (attempts < 3) {
                    throw new Error('Network failure');
                }
                return 'success';
            });
            const result = await (0, common_1.withRetry)(failingOperation, 3, 50); // 50ms base delay
            expect(result).toBe('success');
            expect(attempts).toBe(3);
            expect(failingOperation).toHaveBeenCalledTimes(3);
            // Verify exponential backoff timing (approximate)
            const totalTime = Date.now() - startTime;
            expect(totalTime).toBeGreaterThan(100); // At least 50ms + 100ms delays
        });
        test('withRetry should fail after max retries', async () => {
            const alwaysFailOperation = jest.fn(async () => {
                throw new Error('Persistent failure');
            });
            await expect((0, common_1.withRetry)(alwaysFailOperation, 2, 10)).rejects.toThrow('Persistent failure');
            expect(alwaysFailOperation).toHaveBeenCalledTimes(3); // initial + 2 retries
        });
    });
    describe('App Configuration Tests', () => {
        test('should have correct trigger configuration', () => {
            const trigger = index_1.default.triggers.updated_contact_property;
            expect(trigger).toBeDefined();
            expect(trigger.key).toBe('updated_contact_property');
            expect(trigger.display.label).toBe('Updated Contact Property (Lead Score)');
            expect(trigger.operation.type).toBe('polling');
        });
        test('should have correct create configurations', () => {
            const updateCreate = index_1.default.creates.update_score_timestamp;
            const notificationCreate = index_1.default.creates.send_scoring_notification;
            expect(updateCreate.key).toBe('update_score_timestamp');
            expect(notificationCreate.key).toBe('send_scoring_notification');
            expect(updateCreate.display.label).toContain('Update Score Timestamp');
            expect(notificationCreate.display.label).toContain('Lead Scoring Notification');
        });
        test('should have authentication configuration', () => {
            expect(index_1.default.authentication).toBeDefined();
            expect(index_1.default.authentication.type).toBe('custom');
            expect(index_1.default.authentication.fields.length).toBeGreaterThan(0);
            const apiKeyField = index_1.default.authentication.fields.find((f) => f.key === 'hubspot_api_key');
            const webhookField = index_1.default.authentication.fields.find((f) => f.key === 'slack_webhook_url');
            expect(apiKeyField).toBeDefined();
            expect(webhookField).toBeDefined();
            expect(apiKeyField?.required).toBe(true);
            expect(webhookField?.required).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2VzdHVkaW8vUHJvamVjdHMvR2l0SHViL01JQ1JPU0VSVklDSU9TL2tvcHAtc3RhZGl1bS1jcm1fc2xhY2staHVic3BvdC16YXBwaWVyLW5vdGlvbi9rb3BwLWNybS1hdXRvbWF0aW9uL3Rlc3RzL2xlYWRTY29yaW5nLmludGVncmF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFHQSxrQkFBa0I7QUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUp6QixnRUFBc0M7QUFDdEMsdURBQXVEO0FBS3ZELGdDQUFnQztBQUNoQyxNQUFNLGdCQUFnQixHQUFHLENBQUMsU0FBUyxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM1QyxRQUFRLEVBQUU7UUFDUixlQUFlLEVBQUUsc0JBQXNCO1FBQ3ZDLGlCQUFpQixFQUFFLG1EQUFtRDtLQUN2RTtJQUNELFNBQVMsRUFBRSxFQUFFO0lBQ2IsY0FBYyxFQUFFLEVBQUU7SUFDbEIsVUFBVSxFQUFFLEVBQUU7SUFDZCxHQUFHLFNBQVM7Q0FDYixDQUFDLENBQUM7QUFFSCw2QkFBNkI7QUFDN0IsTUFBTSxXQUFXLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QixPQUFPLEVBQUU7UUFDUCxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2hCO0lBQ0QsTUFBTSxFQUFFO1FBQ04sS0FBSyxFQUFFLEtBQUs7UUFDWixnQkFBZ0IsRUFBRSxLQUFLO1FBQ3ZCLFdBQVcsRUFBRSxLQUFLO0tBQ25CO0lBQ0QsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDbEIsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1FBQ2pCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztLQUMxQjtJQUNELE1BQU0sRUFBRTtRQUNOLEdBQUcs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WSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDbkMsTUFBTSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDekMsTUFBTSxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9lc3R1ZGlvL1Byb2plY3RzL0dpdEh1Yi9NSUNST1NFUlZJQ0lPUy9rb3BwLXN0YWRpdW0tY3JtX3NsYWNrLWh1YnNwb3QtemFwcGllci1ub3Rpb24va29wcC1jcm0tYXV0b21hdGlvbi90ZXN0cy9sZWFkU2NvcmluZy5pbnRlZ3JhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBcHAgZnJvbSAnLi4vc3JjL3phcGllci9pbmRleCc7XG5pbXBvcnQgeyB3aXRoUmV0cnkgfSBmcm9tICcuLi9zcmMvemFwaWVyL3V0aWxzL2NvbW1vbic7XG5cbi8vIE1vY2sgZGVsIGxvZ2dlclxuamVzdC5tb2NrKCdmcy9wcm9taXNlcycpO1xuXG4vLyBIZWxwZXIgcGFyYSBjcmVhciBtb2NrIGJ1bmRsZVxuY29uc3QgY3JlYXRlTW9ja0J1bmRsZSA9IChvdmVycmlkZXMgPSB7fSkgPT4gKHtcbiAgYXV0aERhdGE6IHtcbiAgICBodWJzcG90X2FwaV9rZXk6ICd0ZXN0LWh1YnNwb3QtYXBpLWtleScsXG4gICAgc2xhY2tfd2ViaG9va191cmw6ICdodHRwczovL2hvb2tzLnNsYWNrLmNvbS9zZXJ2aWNlcy90ZXN0L3dlYmhvb2svdXJsJyxcbiAgfSxcbiAgaW5wdXREYXRhOiB7fSxcbiAgY2xlYW5lZFJlcXVlc3Q6IHt9LFxuICByYXdSZXF1ZXN0OiB7fSxcbiAgLi4ub3ZlcnJpZGVzLFxufSk7XG5cbi8vIE1vY2sgZGVsIG9iamV0byB6IChaYXBpZXIpXG5jb25zdCBjcmVhdGVNb2NrWiA9ICgpID0+ICh7XG4gIGNvbnNvbGU6IHtcbiAgICBsb2c6IGplc3QuZm4oKSxcbiAgICBlcnJvcjogamVzdC5mbigpLFxuICAgIHdhcm46IGplc3QuZm4oKSxcbiAgfSxcbiAgZXJyb3JzOiB7XG4gICAgRXJyb3I6IEVycm9yLFxuICAgIFJlZnJlc2hBdXRoRXJyb3I6IEVycm9yLFxuICAgIEhhbHRlZEVycm9yOiBFcnJvcixcbiAgfSxcbiAgcmVxdWVzdDogamVzdC5mbigpLFxuICBKU09OOiB7XG4gICAgcGFyc2U6IEpTT04ucGFyc2UsXG4gICAgc3RyaW5naWZ5OiBKU09OLnN0cmluZ2lmeSxcbiAgfSxcbiAgY3Vyc29yOiB7XG4gICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG51bGwpLFxuICAgIHN0b3JlOiBqZXN0LmZuKCksXG4gIH0sXG59KTtcblxuZGVzY3JpYmUoJ0xlYWQgU2NvcmluZyBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IG1vY2taOiBhbnk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja1ogPSBjcmVhdGVNb2NrWigpO1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXBkYXRlZCBDb250YWN0IFByb3BlcnR5IFRyaWdnZXInLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGRldGVjdCBjb250YWN0cyB3aXRoIHVwZGF0ZWQgbGVhZF9zY29yZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZGUgcmVzcHVlc3RhIGRlIEh1YlNwb3QgQVBJXG4gICAgICBjb25zdCBtb2NrQ29udGFjdHNSZXNwb25zZSA9IHtcbiAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICByZXN1bHRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAnY29udGFjdC0xMjMnLFxuICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgZW1haWw6ICdqb2huLmRvZUBleGFtcGxlLmNvbScsXG4gICAgICAgICAgICAgICAgZmlyc3RuYW1lOiAnSm9obicsXG4gICAgICAgICAgICAgICAgbGFzdG5hbWU6ICdEb2UnLFxuICAgICAgICAgICAgICAgIGxlYWRfc2NvcmU6ICc3NScsXG4gICAgICAgICAgICAgICAgbGFzdF9zY29yZV91cGRhdGU6ICcyMDI0LTAxLTE1VDA5OjAwOjAwWicsXG4gICAgICAgICAgICAgICAgaHNfbGFzdG1vZGlmaWVkZGF0ZTogJzIwMjQtMDEtMTVUMTA6MzA6MDBaJyxcbiAgICAgICAgICAgICAgICBjb21wYW55OiAnRXhhbXBsZSBDb3JwJyxcbiAgICAgICAgICAgICAgICBwaG9uZTogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAnY29udGFjdC00NTYnLFxuICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgZW1haWw6ICdqYW5lLnNtaXRoQGV4YW1wbGUuY29tJyxcbiAgICAgICAgICAgICAgICBmaXJzdG5hbWU6ICdKYW5lJyxcbiAgICAgICAgICAgICAgICBsYXN0bmFtZTogJ1NtaXRoJyxcbiAgICAgICAgICAgICAgICBsZWFkX3Njb3JlOiAnNDUnLFxuICAgICAgICAgICAgICAgIGxhc3Rfc2NvcmVfdXBkYXRlOiAnMjAyNC0wMS0xNVQxMTowMDowMFonLFxuICAgICAgICAgICAgICAgIGhzX2xhc3Rtb2RpZmllZGRhdGU6ICcyMDI0LTAxLTE1VDEwOjMwOjAwWicsIC8vIE9sZGVyIHRoYW4gbGFzdF9zY29yZV91cGRhdGVcbiAgICAgICAgICAgICAgICBjb21wYW55OiAnVGVzdCBDb3JwJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2taLnJlcXVlc3QubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbnRhY3RzUmVzcG9uc2UpO1xuXG4gICAgICBjb25zdCBidW5kbGUgPSBjcmVhdGVNb2NrQnVuZGxlKCk7XG4gICAgICBjb25zdCB0cmlnZ2VyID0gQXBwLnRyaWdnZXJzLnVwZGF0ZWRfY29udGFjdF9wcm9wZXJ0eTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRyaWdnZXIub3BlcmF0aW9uLnBlcmZvcm0obW9ja1osIGJ1bmRsZSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0cykpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIFNvbG8gZGViZXLDrWEgcmV0b3JuYXIgY29udGFjdC0xMjMgcG9ycXVlIHN1IHNjb3JlIGZ1ZSBhY3R1YWxpemFkbyBkZXNwdcOpcyBkZSBsYXN0X3Njb3JlX3VwZGF0ZVxuICAgICAgZXhwZWN0KHJlc3VsdHMubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0pLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBpZDogJ2NvbnRhY3QtMTIzJyxcbiAgICAgICAgZW1haWw6ICdqb2huLmRvZUBleGFtcGxlLmNvbScsXG4gICAgICAgIGxlYWRfc2NvcmU6IDc1LFxuICAgICAgICBmaXJzdG5hbWU6ICdKb2huJyxcbiAgICAgICAgbGFzdG5hbWU6ICdEb2UnLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrWi5yZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLmh1YmFwaS5jb20vY3JtL3YzL29iamVjdHMvY29udGFjdHMvc2VhcmNoJyxcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICBoZWFkZXJzOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyIHRlc3QtaHVic3BvdC1hcGkta2V5JyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHJlc3VsdHMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2taLnJlcXVlc3QubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgZGF0YTogeyByZXN1bHRzOiBbXSB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGJ1bmRsZSA9IGNyZWF0ZU1vY2tCdW5kbGUoKTtcbiAgICAgIGNvbnN0IHRyaWdnZXIgPSBBcHAudHJpZ2dlcnMudXBkYXRlZF9jb250YWN0X3Byb3BlcnR5O1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdHJpZ2dlci5vcGVyYXRpb24ucGVyZm9ybShtb2NrWiwgYnVuZGxlKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJldHJ5IG9uIG5ldHdvcmsgZmFpbHVyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrWi5yZXF1ZXN0XG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdOZXR3b3JrIHRpbWVvdXQnKSlcbiAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ0Nvbm5lY3Rpb24gcmVmdXNlZCcpKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgIGRhdGE6IHsgcmVzdWx0czogW10gfSxcbiAgICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGJ1bmRsZSA9IGNyZWF0ZU1vY2tCdW5kbGUoKTtcbiAgICAgIGNvbnN0IHRyaWdnZXIgPSBBcHAudHJpZ2dlcnMudXBkYXRlZF9jb250YWN0X3Byb3BlcnR5O1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdHJpZ2dlci5vcGVyYXRpb24ucGVyZm9ybShtb2NrWiwgYnVuZGxlKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvRXF1YWwoW10pO1xuICAgICAgZXhwZWN0KG1vY2taLnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygzKTsgLy8gMSBpbml0aWFsICsgMiByZXRyaWVzXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdVcGRhdGUgU2NvcmUgVGltZXN0YW1wIENyZWF0ZSBBY3Rpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHVwZGF0ZSBsYXN0X3Njb3JlX3VwZGF0ZSB0aW1lc3RhbXAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXBkYXRlUmVzcG9uc2UgPSB7XG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6ICdjb250YWN0LTEyMycsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgZW1haWw6ICdqb2huLmRvZUBleGFtcGxlLmNvbScsXG4gICAgICAgICAgICBsZWFkX3Njb3JlOiAnNzUnLFxuICAgICAgICAgICAgbGFzdF9zY29yZV91cGRhdGU6ICcyMDI0LTAxLTE1VDEyOjAwOjAwWicsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2taLnJlcXVlc3QubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VwZGF0ZVJlc3BvbnNlKTtcblxuICAgICAgY29uc3QgYnVuZGxlID0gY3JlYXRlTW9ja0J1bmRsZSh7XG4gICAgICAgIGlucHV0RGF0YToge1xuICAgICAgICAgIGNvbnRhY3RfaWQ6ICdjb250YWN0LTEyMycsXG4gICAgICAgICAgZW1haWw6ICdqb2huLmRvZUBleGFtcGxlLmNvbScsXG4gICAgICAgICAgbGVhZF9zY29yZTogNzUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY3JlYXRlID0gQXBwLmNyZWF0ZXMudXBkYXRlX3Njb3JlX3RpbWVzdGFtcDtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNyZWF0ZS5vcGVyYXRpb24ucGVyZm9ybShtb2NrWiwgYnVuZGxlKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIGNvbnRhY3RfaWQ6ICdjb250YWN0LTEyMycsXG4gICAgICAgIGVtYWlsOiAnam9obi5kb2VAZXhhbXBsZS5jb20nLFxuICAgICAgICBsZWFkX3Njb3JlOiA3NSxcbiAgICAgICAgdXBkYXRlZF9wcm9wZXJ0aWVzOiBleHBlY3QuYXJyYXlDb250YWluaW5nKFtcbiAgICAgICAgICAnbGFzdF9zY29yZV91cGRhdGUnLFxuICAgICAgICAgICdsZWFkX3Njb3JlJyxcbiAgICAgICAgXSksXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KG1vY2taLnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGkuaHViYXBpLmNvbS9jcm0vdjMvb2JqZWN0cy9jb250YWN0cy9jb250YWN0LTEyMycsXG4gICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgIGpzb246IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgbGFzdF9zY29yZV91cGRhdGU6IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBmYWlsIHdpdGhvdXQgY29udGFjdF9pZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1bmRsZSA9IGNyZWF0ZU1vY2tCdW5kbGUoe1xuICAgICAgICBpbnB1dERhdGE6IHtcbiAgICAgICAgICBlbWFpbDogJ2pvaG4uZG9lQGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBsZWFkX3Njb3JlOiA3NSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjcmVhdGUgPSBBcHAuY3JlYXRlcy51cGRhdGVfc2NvcmVfdGltZXN0YW1wO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY3JlYXRlLm9wZXJhdGlvbi5wZXJmb3JtKG1vY2taLCBidW5kbGUpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdDb250YWN0IElEIGlzIHJlcXVpcmVkJ1xuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlbmQgU2NvcmluZyBOb3RpZmljYXRpb24gQ3JlYXRlIEFjdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgc2VuZCBub3RpZmljYXRpb24gZm9yIHNjb3JlID49IDUwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1NsYWNrUmVzcG9uc2UgPSB7XG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBkYXRhOiB7IG9rOiB0cnVlIH0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrWi5yZXF1ZXN0Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTbGFja1Jlc3BvbnNlKTtcblxuICAgICAgY29uc3QgYnVuZGxlID0gY3JlYXRlTW9ja0J1bmRsZSh7XG4gICAgICAgIGlucHV0RGF0YToge1xuICAgICAgICAgIGVtYWlsOiAnam9obi5kb2VAZXhhbXBsZS5jb20nLFxuICAgICAgICAgIGxlYWRfc2NvcmU6IDc1LFxuICAgICAgICAgIGZpcnN0bmFtZTogJ0pvaG4nLFxuICAgICAgICAgIGxhc3RuYW1lOiAnRG9lJyxcbiAgICAgICAgICBjb21wYW55OiAnRXhhbXBsZSBDb3JwJyxcbiAgICAgICAgICBjb250YWN0X2lkOiAnY29udGFjdC0xMjMnLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNyZWF0ZSA9IEFwcC5jcmVhdGVzLnNlbmRfc2NvcmluZ19ub3RpZmljYXRpb247XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGUub3BlcmF0aW9uLnBlcmZvcm0obW9ja1osIGJ1bmRsZSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuYmxvY2tzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5ibG9ja3MubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmNoYW5uZWwpLnRvQmUoJyNzY29yaW5nLWxlYWRzJyk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBlc3RydWN0dXJhIGRlbCBtZW5zYWplXG4gICAgICBleHBlY3QocmVzdWx0LmJsb2Nrc1swXSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHR5cGU6ICdzZWN0aW9uJyxcbiAgICAgICAgdGV4dDoge1xuICAgICAgICAgIHR5cGU6ICdtcmtkd24nLFxuICAgICAgICAgIHRleHQ6ICfwn5OIICpMZWFkIFNjb3JlIEFjdHVhbGl6YWRvKicsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5ibG9ja3NbMV0uZmllbGRzKS50b0VxdWFsKFxuICAgICAgICBleHBlY3QuYXJyYXlDb250YWluaW5nKFtcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICB0ZXh0OiBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnam9obi5kb2VAZXhhbXBsZS5jb20nKSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICB0ZXh0OiBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnNzUnKSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgXSlcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtb2NrWi5yZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHVybDogJ2h0dHBzOi8vaG9va3Muc2xhY2suY29tL3NlcnZpY2VzL3Rlc3Qvd2ViaG9vay91cmwnLFxuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGpzb246IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGJsb2NrczogZXhwZWN0LmFueShBcnJheSksXG4gICAgICAgICAgICBjaGFubmVsOiAnI3Njb3JpbmctbGVhZHMnLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBza2lwIG5vdGlmaWNhdGlvbiBmb3Igc2NvcmUgPCA1MCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1bmRsZSA9IGNyZWF0ZU1vY2tCdW5kbGUoe1xuICAgICAgICBpbnB1dERhdGE6IHtcbiAgICAgICAgICBlbWFpbDogJ2pvaG4uZG9lQGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBsZWFkX3Njb3JlOiAzNSxcbiAgICAgICAgICBmaXJzdG5hbWU6ICdKb2huJyxcbiAgICAgICAgICBsYXN0bmFtZTogJ0RvZScsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY3JlYXRlID0gQXBwLmNyZWF0ZXMuc2VuZF9zY29yaW5nX25vdGlmaWNhdGlvbjtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IChhd2FpdCBjcmVhdGUub3BlcmF0aW9uLnBlcmZvcm0obW9ja1osIGJ1bmRsZSkpIGFzIGFueTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5za2lwcGVkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWFzb24pLnRvQ29udGFpbignYmVsb3cgdGhyZXNob2xkJyk7XG4gICAgICBleHBlY3QobW9ja1oucmVxdWVzdCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBpbmNsdWRlIHNjb3JlIGxldmVsIGZvciBoaWdoIHNjb3JlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTbGFja1Jlc3BvbnNlID0ge1xuICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgZGF0YTogeyBvazogdHJ1ZSB9LFxuICAgICAgfTtcblxuICAgICAgbW9ja1oucmVxdWVzdC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU2xhY2tSZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IGJ1bmRsZSA9IGNyZWF0ZU1vY2tCdW5kbGUoe1xuICAgICAgICBpbnB1dERhdGE6IHtcbiAgICAgICAgICBlbWFpbDogJ2hvdC5sZWFkQGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBsZWFkX3Njb3JlOiA4NSxcbiAgICAgICAgICBmaXJzdG5hbWU6ICdIb3QnLFxuICAgICAgICAgIGxhc3RuYW1lOiAnTGVhZCcsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY3JlYXRlID0gQXBwLmNyZWF0ZXMuc2VuZF9zY29yaW5nX25vdGlmaWNhdGlvbjtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNyZWF0ZS5vcGVyYXRpb24ucGVyZm9ybShtb2NrWiwgYnVuZGxlKTtcblxuICAgICAgLy8gQnVzY2FyIGVsIGJsb3F1ZSBxdWUgY29udGllbmUgXCJIT1QgTEVBRFwiXG4gICAgICBjb25zdCBzY29yZUJsb2NrID0gcmVzdWx0LmJsb2Nrcy5maW5kKChibG9jazogYW55KSA9PlxuICAgICAgICBibG9jay50ZXh0Py50ZXh0Py5pbmNsdWRlcygn8J+UpSAqSE9UIExFQUQqJylcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChzY29yZUJsb2NrKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJldHJ5IG9uIFNsYWNrIEFQSSBmYWlsdXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2taLnJlcXVlc3RcbiAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ1NsYWNrIEFQSSB0aW1lb3V0JykpXG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdTZXJ2aWNlIHVuYXZhaWxhYmxlJykpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgZGF0YTogeyBvazogdHJ1ZSB9LFxuICAgICAgICB9KTtcblxuICAgICAgY29uc3QgYnVuZGxlID0gY3JlYXRlTW9ja0J1bmRsZSh7XG4gICAgICAgIGlucHV0RGF0YToge1xuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgICAgbGVhZF9zY29yZTogNjAsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY3JlYXRlID0gQXBwLmNyZWF0ZXMuc2VuZF9zY29yaW5nX25vdGlmaWNhdGlvbjtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNyZWF0ZS5vcGVyYXRpb24ucGVyZm9ybShtb2NrWiwgYnVuZGxlKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5ibG9ja3MpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja1oucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gV29ya2Zsb3cgVGVzdHMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGNvbXBsZXRlIGZ1bGwgbGVhZCBzY29yaW5nIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayByZXNwb25zZXMgZm9yIHRoZSBjb21wbGV0ZSB3b3JrZmxvd1xuICAgICAgY29uc3QgbW9ja1NlYXJjaFJlc3BvbnNlID0ge1xuICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHJlc3VsdHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6ICdjb250YWN0LTEyMycsXG4gICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICBlbWFpbDogJ3dvcmtmbG93QGV4YW1wbGUuY29tJyxcbiAgICAgICAgICAgICAgICBmaXJzdG5hbWU6ICdXb3JrZmxvdycsXG4gICAgICAgICAgICAgICAgbGFzdG5hbWU6ICdUZXN0JyxcbiAgICAgICAgICAgICAgICBsZWFkX3Njb3JlOiAnNjUnLFxuICAgICAgICAgICAgICAgIGxhc3Rfc2NvcmVfdXBkYXRlOiAnMjAyNC0wMS0xNVQwOTowMDowMFonLFxuICAgICAgICAgICAgICAgIGhzX2xhc3Rtb2RpZmllZGRhdGU6ICcyMDI0LTAxLTE1VDEwOjMwOjAwWicsXG4gICAgICAgICAgICAgICAgY29tcGFueTogJ1Rlc3QgQ29tcGFueScsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrVXBkYXRlUmVzcG9uc2UgPSB7XG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6ICdjb250YWN0LTEyMycsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgZW1haWw6ICd3b3JrZmxvd0BleGFtcGxlLmNvbScsXG4gICAgICAgICAgICBsZWFkX3Njb3JlOiAnNjUnLFxuICAgICAgICAgICAgbGFzdF9zY29yZV91cGRhdGU6ICcyMDI0LTAxLTE1VDEyOjAwOjAwWicsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tTbGFja1Jlc3BvbnNlID0ge1xuICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgZGF0YTogeyBvazogdHJ1ZSB9LFxuICAgICAgfTtcblxuICAgICAgLy8gU3RlcCAxOiBUcmlnZ2VyIC0gR2V0IHVwZGF0ZWQgY29udGFjdHNcbiAgICAgIG1vY2taLnJlcXVlc3QubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG1vY2tTZWFyY2hSZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IGJ1bmRsZSA9IGNyZWF0ZU1vY2tCdW5kbGUoKTtcbiAgICAgIGNvbnN0IHRyaWdnZXIgPSBBcHAudHJpZ2dlcnMudXBkYXRlZF9jb250YWN0X3Byb3BlcnR5O1xuICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCB0cmlnZ2VyLm9wZXJhdGlvbi5wZXJmb3JtKG1vY2taLCBidW5kbGUpO1xuXG4gICAgICBleHBlY3QoY29udGFjdHMubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgY29uc3QgY29udGFjdCA9IGNvbnRhY3RzWzBdO1xuXG4gICAgICAvLyBTdGVwIDI6IFVwZGF0ZSB0aW1lc3RhbXBcbiAgICAgIG1vY2taLnJlcXVlc3QubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG1vY2tVcGRhdGVSZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUJ1bmRsZSA9IGNyZWF0ZU1vY2tCdW5kbGUoe1xuICAgICAgICBpbnB1dERhdGE6IHtcbiAgICAgICAgICBjb250YWN0X2lkOiBjb250YWN0LmlkLFxuICAgICAgICAgIGVtYWlsOiBjb250YWN0LmVtYWlsLFxuICAgICAgICAgIGxlYWRfc2NvcmU6IGNvbnRhY3QubGVhZF9zY29yZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB1cGRhdGVDcmVhdGUgPSBBcHAuY3JlYXRlcy51cGRhdGVfc2NvcmVfdGltZXN0YW1wO1xuICAgICAgY29uc3QgdXBkYXRlUmVzdWx0ID0gYXdhaXQgdXBkYXRlQ3JlYXRlLm9wZXJhdGlvbi5wZXJmb3JtKFxuICAgICAgICBtb2NrWixcbiAgICAgICAgdXBkYXRlQnVuZGxlXG4gICAgICApO1xuXG4gICAgICBleHBlY3QodXBkYXRlUmVzdWx0LmNvbnRhY3RfaWQpLnRvQmUoJ2NvbnRhY3QtMTIzJyk7XG5cbiAgICAgIC8vIFN0ZXAgMzogU2VuZCBub3RpZmljYXRpb24gKHNjb3JlID49IDUwKVxuICAgICAgbW9ja1oucmVxdWVzdC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja1NsYWNrUmVzcG9uc2UpO1xuXG4gICAgICBjb25zdCBub3RpZmljYXRpb25CdW5kbGUgPSBjcmVhdGVNb2NrQnVuZGxlKHtcbiAgICAgICAgaW5wdXREYXRhOiB7XG4gICAgICAgICAgZW1haWw6IGNvbnRhY3QuZW1haWwsXG4gICAgICAgICAgbGVhZF9zY29yZTogY29udGFjdC5sZWFkX3Njb3JlLFxuICAgICAgICAgIGZpcnN0bmFtZTogY29udGFjdC5maXJzdG5hbWUsXG4gICAgICAgICAgbGFzdG5hbWU6IGNvbnRhY3QubGFzdG5hbWUsXG4gICAgICAgICAgY29tcGFueTogY29udGFjdC5jb21wYW55LFxuICAgICAgICAgIGNvbnRhY3RfaWQ6IGNvbnRhY3QuaWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uQ3JlYXRlID0gQXBwLmNyZWF0ZXMuc2VuZF9zY29yaW5nX25vdGlmaWNhdGlvbjtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvblJlc3VsdCA9IGF3YWl0IG5vdGlmaWNhdGlvbkNyZWF0ZS5vcGVyYXRpb24ucGVyZm9ybShcbiAgICAgICAgbW9ja1osXG4gICAgICAgIG5vdGlmaWNhdGlvbkJ1bmRsZVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG5vdGlmaWNhdGlvblJlc3VsdC5ibG9ja3MpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qobm90aWZpY2F0aW9uUmVzdWx0LmNoYW5uZWwpLnRvQmUoJyNzY29yaW5nLWxlYWRzJyk7XG5cbiAgICAgIC8vIFZlcmlmeSBhbGwgQVBJIGNhbGxzIHdlcmUgbWFkZVxuICAgICAgZXhwZWN0KG1vY2taLnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1V0aWxpdHkgRnVuY3Rpb24gVGVzdHMnLCAoKSA9PiB7XG4gICAgdGVzdCgnd2l0aFJldHJ5IHNob3VsZCBoYW5kbGUgZXhwb25lbnRpYWwgYmFja29mZicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICBsZXQgYXR0ZW1wdHMgPSAwO1xuXG4gICAgICBjb25zdCBmYWlsaW5nT3BlcmF0aW9uID0gamVzdC5mbihhc3luYyAoKSA9PiB7XG4gICAgICAgIGF0dGVtcHRzKys7XG4gICAgICAgIGlmIChhdHRlbXB0cyA8IDMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05ldHdvcmsgZmFpbHVyZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnc3VjY2Vzcyc7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2l0aFJldHJ5KGZhaWxpbmdPcGVyYXRpb24sIDMsIDUwKTsgLy8gNTBtcyBiYXNlIGRlbGF5XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3N1Y2Nlc3MnKTtcbiAgICAgIGV4cGVjdChhdHRlbXB0cykudG9CZSgzKTtcbiAgICAgIGV4cGVjdChmYWlsaW5nT3BlcmF0aW9uKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7XG5cbiAgICAgIC8vIFZlcmlmeSBleHBvbmVudGlhbCBiYWNrb2ZmIHRpbWluZyAoYXBwcm94aW1hdGUpXG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgZXhwZWN0KHRvdGFsVGltZSkudG9CZUdyZWF0ZXJUaGFuKDEwMCk7IC8vIEF0IGxlYXN0IDUwbXMgKyAxMDBtcyBkZWxheXNcbiAgICB9KTtcblxuICAgIHRlc3QoJ3dpdGhSZXRyeSBzaG91bGQgZmFpbCBhZnRlciBtYXggcmV0cmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFsd2F5c0ZhaWxPcGVyYXRpb24gPSBqZXN0LmZuKGFzeW5jICgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQZXJzaXN0ZW50IGZhaWx1cmUnKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3Qod2l0aFJldHJ5KGFsd2F5c0ZhaWxPcGVyYXRpb24sIDIsIDEwKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnUGVyc2lzdGVudCBmYWlsdXJlJ1xuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGFsd2F5c0ZhaWxPcGVyYXRpb24pLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygzKTsgLy8gaW5pdGlhbCArIDIgcmV0cmllc1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQXBwIENvbmZpZ3VyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhdmUgY29ycmVjdCB0cmlnZ2VyIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCB0cmlnZ2VyID0gQXBwLnRyaWdnZXJzLnVwZGF0ZWRfY29udGFjdF9wcm9wZXJ0eTtcblxuICAgICAgZXhwZWN0KHRyaWdnZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHJpZ2dlci5rZXkpLnRvQmUoJ3VwZGF0ZWRfY29udGFjdF9wcm9wZXJ0eScpO1xuICAgICAgZXhwZWN0KHRyaWdnZXIuZGlzcGxheS5sYWJlbCkudG9CZShcbiAgICAgICAgJ1VwZGF0ZWQgQ29udGFjdCBQcm9wZXJ0eSAoTGVhZCBTY29yZSknXG4gICAgICApO1xuICAgICAgZXhwZWN0KHRyaWdnZXIub3BlcmF0aW9uLnR5cGUpLnRvQmUoJ3BvbGxpbmcnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgY3JlYXRlIGNvbmZpZ3VyYXRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlQ3JlYXRlID0gQXBwLmNyZWF0ZXMudXBkYXRlX3Njb3JlX3RpbWVzdGFtcDtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbkNyZWF0ZSA9IEFwcC5jcmVhdGVzLnNlbmRfc2NvcmluZ19ub3RpZmljYXRpb247XG5cbiAgICAgIGV4cGVjdCh1cGRhdGVDcmVhdGUua2V5KS50b0JlKCd1cGRhdGVfc2NvcmVfdGltZXN0YW1wJyk7XG4gICAgICBleHBlY3Qobm90aWZpY2F0aW9uQ3JlYXRlLmtleSkudG9CZSgnc2VuZF9zY29yaW5nX25vdGlmaWNhdGlvbicpO1xuXG4gICAgICBleHBlY3QodXBkYXRlQ3JlYXRlLmRpc3BsYXkubGFiZWwpLnRvQ29udGFpbignVXBkYXRlIFNjb3JlIFRpbWVzdGFtcCcpO1xuICAgICAgZXhwZWN0KG5vdGlmaWNhdGlvbkNyZWF0ZS5kaXNwbGF5LmxhYmVsKS50b0NvbnRhaW4oXG4gICAgICAgICdMZWFkIFNjb3JpbmcgTm90aWZpY2F0aW9uJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGF1dGhlbnRpY2F0aW9uIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoQXBwLmF1dGhlbnRpY2F0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KEFwcC5hdXRoZW50aWNhdGlvbi50eXBlKS50b0JlKCdjdXN0b20nKTtcbiAgICAgIGV4cGVjdChBcHAuYXV0aGVudGljYXRpb24uZmllbGRzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuXG4gICAgICBjb25zdCBhcGlLZXlGaWVsZCA9IEFwcC5hdXRoZW50aWNhdGlvbi5maWVsZHMuZmluZChcbiAgICAgICAgKGYpID0+IGYua2V5ID09PSAnaHVic3BvdF9hcGlfa2V5J1xuICAgICAgKTtcbiAgICAgIGNvbnN0IHdlYmhvb2tGaWVsZCA9IEFwcC5hdXRoZW50aWNhdGlvbi5maWVsZHMuZmluZChcbiAgICAgICAgKGYpID0+IGYua2V5ID09PSAnc2xhY2tfd2ViaG9va191cmwnXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYXBpS2V5RmllbGQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qod2ViaG9va0ZpZWxkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFwaUtleUZpZWxkPy5yZXF1aXJlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdCh3ZWJob29rRmllbGQ/LnJlcXVpcmVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9