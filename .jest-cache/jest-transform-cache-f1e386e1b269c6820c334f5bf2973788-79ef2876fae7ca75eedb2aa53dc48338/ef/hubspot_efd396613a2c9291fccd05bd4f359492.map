{"file":"/Users/estudio/Projects/GitHub/MICROSERVICIOS/kopp-stadium-crm_slack-hubspot-zappier-notion/kopp-crm-automation/src/routes/hubspot.ts","mappings":"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","names":[],"sources":["/Users/estudio/Projects/GitHub/MICROSERVICIOS/kopp-stadium-crm_slack-hubspot-zappier-notion/kopp-crm-automation/src/routes/hubspot.ts"],"sourcesContent":["import express from 'express';\nimport { Request, Response } from 'express';\n\nconst router = express.Router();\n\n/**\n * @swagger\n * /hubspot/contacts:\n *   post:\n *     tags: [HubSpot]\n *     summary: Crear nuevo contacto en HubSpot\n *     description: |\n *       Crea un nuevo contacto en HubSpot CRM con validaci√≥n autom√°tica y scoring de leads.\n *\n *       **Caracter√≠sticas:**\n *       - üìä C√°lculo autom√°tico de lead score\n *       - üîÑ Deduplicaci√≥n inteligente por email\n *       - üè∑Ô∏è Asignaci√≥n autom√°tica de tags y propiedades\n *       - üìà Integraci√≥n con pipelines de ventas\n *       - üîî Notificaciones autom√°ticas a Slack\n *\n *       **Validaciones autom√°ticas:**\n *       - ‚úÖ Formato de email v√°lido\n *       - üìû Validaci√≥n de formato de tel√©fono\n *       - üåê Verificaci√≥n de dominio de empresa\n *       - üö´ Prevenci√≥n de contactos duplicados\n *\n *       **Lead Scoring autom√°tico basado en:**\n *       - üè¢ Tama√±o y tipo de empresa\n *       - üìä Comportamiento en website\n *       - üéØ Fuente del lead\n *       - üìß Engagement con emails\n *     security:\n *       - hubspotAuth: []\n *     requestBody:\n *       required: true\n *       content:\n *         application/json:\n *           schema:\n *             $ref: '#/components/schemas/HubSpotContact'\n *           examples:\n *             basic_contact:\n *               summary: Contacto b√°sico\n *               value:\n *                 email: \"juan.perez@acme.com\"\n *                 firstname: \"Juan\"\n *                 lastname: \"P√©rez\"\n *                 phone: \"+34 600 123 456\"\n *                 company: \"Acme Corp\"\n *                 source: \"Website Form\"\n *             qualified_lead:\n *               summary: Lead cualificado con scoring\n *               value:\n *                 email: \"maria.garcia@enterprise.com\"\n *                 firstname: \"Mar√≠a\"\n *                 lastname: \"Garc√≠a\"\n *                 phone: \"+34 910 234 567\"\n *                 company: \"Enterprise Solutions\"\n *                 lead_score: 85\n *                 source: \"Demo Request\"\n *                 jobtitle: \"Director de Marketing\"\n *                 website: \"https://enterprise.com\"\n *                 industry: \"Technology\"\n *                 num_employees: \"201-500\"\n *     responses:\n *       201:\n *         description: Contacto creado exitosamente\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 success:\n *                   type: boolean\n *                   example: true\n *                 contact_id:\n *                   type: string\n *                   description: ID √∫nico del contacto en HubSpot\n *                   example: \"12345678901\"\n *                 lead_score:\n *                   type: integer\n *                   description: Score calculado del lead\n *                   example: 85\n *                 hubspot_url:\n *                   type: string\n *                   description: URL del contacto en HubSpot\n *                   example: \"https://app.hubspot.com/contacts/123456/contact/12345678901\"\n *                 notifications:\n *                   type: object\n *                   properties:\n *                     slack_sent:\n *                       type: boolean\n *                       description: Si se envi√≥ notificaci√≥n a Slack\n *                     zapier_triggered:\n *                       type: boolean\n *                       description: Si se activaron Zaps de Zapier\n *                 created_at:\n *                   type: string\n *                   format: date-time\n *                   description: Timestamp de creaci√≥n\n *             example:\n *               success: true\n *               contact_id: \"12345678901\"\n *               lead_score: 85\n *               hubspot_url: \"https://app.hubspot.com/contacts/123456/contact/12345678901\"\n *               notifications:\n *                 slack_sent: true\n *                 zapier_triggered: true\n *               created_at: \"2024-06-29T18:00:00.000Z\"\n *       400:\n *         $ref: '#/components/responses/BadRequest'\n *       401:\n *         $ref: '#/components/responses/Unauthorized'\n *       409:\n *         description: Contacto ya existe\n *         content:\n *           application/json:\n *             schema:\n *               allOf:\n *                 - $ref: '#/components/schemas/Error'\n *                 - type: object\n *                   properties:\n *                     existing_contact:\n *                       type: object\n *                       properties:\n *                         id: { type: string }\n *                         email: { type: string }\n *                         created_at: { type: string }\n *             example:\n *               error: \"CONTACT_ALREADY_EXISTS\"\n *               message: \"Ya existe un contacto con este email\"\n *               existing_contact:\n *                 id: \"98765432109\"\n *                 email: \"juan.perez@acme.com\"\n *                 created_at: \"2024-06-25T10:30:00.000Z\"\n *       500:\n *         $ref: '#/components/responses/InternalError'\n */\nrouter.post('/contacts', async (req: Request, res: Response): Promise<void> => {\n  try {\n    const { email, firstname, lastname, phone, company, lead_score, source } =\n      req.body;\n\n    // Validaci√≥n b√°sica\n    if (!email) {\n      res.status(400).json({\n        error: 'MISSING_EMAIL',\n        message: 'El campo email es obligatorio',\n      });\n      return;\n    }\n\n    // Validar formato de email\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      res.status(400).json({\n        error: 'INVALID_EMAIL_FORMAT',\n        message: 'El formato del email no es v√°lido',\n      });\n      return;\n    }\n\n    // Mock response - En producci√≥n aqu√≠ ir√≠a la integraci√≥n real con HubSpot\n    const contactId = `${Date.now()}${Math.floor(Math.random() * 1000)}`;\n    const calculatedScore = lead_score || Math.floor(Math.random() * 100);\n\n    // Simular creaci√≥n exitosa\n    const response = {\n      success: true,\n      contact_id: contactId,\n      lead_score: calculatedScore,\n      hubspot_url: `https://app.hubspot.com/contacts/123456/contact/${contactId}`,\n      notifications: {\n        slack_sent: calculatedScore > 70,\n        zapier_triggered: true,\n      },\n      contact_data: {\n        email,\n        firstname,\n        lastname,\n        phone,\n        company,\n        source,\n      },\n      created_at: new Date().toISOString(),\n    };\n\n    res.status(201).json(response);\n  } catch (error) {\n    res.status(500).json({\n      error: 'CONTACT_CREATION_FAILED',\n      message: error instanceof Error ? error.message : 'Error desconocido',\n      timestamp: new Date().toISOString(),\n    });\n  }\n});\n\n/**\n * @swagger\n * /hubspot/contacts/{contactId}/score:\n *   put:\n *     tags: [HubSpot]\n *     summary: Actualizar score de un contacto\n *     description: |\n *       Actualiza el score de un contacto existente en HubSpot y dispara automatizaciones basadas en el nuevo score.\n *\n *       **Automatizaciones disparadas:**\n *       - üîî Notificaci√≥n a Slack si score > 70\n *       - üìß Asignaci√≥n autom√°tica a sales rep si score > 80\n *       - üè∑Ô∏è Actualizaci√≥n de tags y lifecycle stage\n *       - üìä Actualizaci√≥n en Google Sheets para reporting\n *       - ‚ö° Trigger de Zapier workflows\n *\n *       **Factores de scoring considerados:**\n *       - üë§ Informaci√≥n demogr√°fica (20%)\n *       - üåê Comportamiento en website (30%)\n *       - üìß Engagement con emails (25%)\n *       - üíº Fit de empresa (25%)\n *     security:\n *       - hubspotAuth: []\n *     parameters:\n *       - in: path\n *         name: contactId\n *         required: true\n *         schema:\n *           type: string\n *         description: ID √∫nico del contacto en HubSpot\n *         example: \"12345678901\"\n *     requestBody:\n *       required: true\n *       content:\n *         application/json:\n *           schema:\n *             $ref: '#/components/schemas/LeadScoring'\n *           examples:\n *             high_score_update:\n *               summary: Actualizaci√≥n de score alto\n *               value:\n *                 score: 90\n *                 factors:\n *                   demographic: 18\n *                   behavioral: 28\n *                   engagement: 22\n *                   company_fit: 22\n *                 updated_by: \"automated_scoring\"\n *                 reason: \"Downloaded whitepaper and requested demo\"\n *             medium_score_update:\n *               summary: Actualizaci√≥n de score medio\n *               value:\n *                 score: 65\n *                 factors:\n *                   demographic: 15\n *                   behavioral: 20\n *                   engagement: 15\n *                   company_fit: 15\n *                 updated_by: \"behavioral_tracking\"\n *                 reason: \"Multiple page views and form submission\"\n *     responses:\n *       200:\n *         description: Score actualizado exitosamente\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 success:\n *                   type: boolean\n *                 contact_id:\n *                   type: string\n *                 previous_score:\n *                   type: integer\n *                 new_score:\n *                   type: integer\n *                 score_change:\n *                   type: integer\n *                   description: Diferencia en el score\n *                 automations_triggered:\n *                   type: array\n *                   items:\n *                     type: string\n *                   description: Lista de automatizaciones disparadas\n *                 updated_at:\n *                   type: string\n *                   format: date-time\n *             example:\n *               success: true\n *               contact_id: \"12345678901\"\n *               previous_score: 45\n *               new_score: 90\n *               score_change: 45\n *               automations_triggered:\n *                 - \"slack_high_score_alert\"\n *                 - \"assign_to_sales_rep\"\n *                 - \"update_lifecycle_stage\"\n *                 - \"zapier_qualified_lead_workflow\"\n *               updated_at: \"2024-06-29T18:00:00.000Z\"\n *       400:\n *         $ref: '#/components/responses/BadRequest'\n *       401:\n *         $ref: '#/components/responses/Unauthorized'\n *       404:\n *         $ref: '#/components/responses/NotFound'\n *       500:\n *         $ref: '#/components/responses/InternalError'\n */\nrouter.put(\n  '/contacts/:contactId/score',\n  async (req: Request, res: Response): Promise<void> => {\n    try {\n      const { contactId } = req.params;\n      const { score, factors, updated_by, reason } = req.body;\n\n      // Validaci√≥n b√°sica\n      if (!contactId) {\n        res.status(400).json({\n          error: 'MISSING_CONTACT_ID',\n          message: 'ID de contacto requerido',\n        });\n        return;\n      }\n\n      if (typeof score !== 'number' || score < 0 || score > 100) {\n        res.status(400).json({\n          error: 'INVALID_SCORE',\n          message: 'El score debe ser un n√∫mero entre 0 y 100',\n        });\n        return;\n      }\n\n      // Mock response - En producci√≥n aqu√≠ ir√≠a la integraci√≥n real con HubSpot\n      const previousScore = Math.floor(Math.random() * 100);\n      const scoreChange = score - previousScore;\n\n      const automationsTriggered = [];\n      if (score > 70) automationsTriggered.push('slack_high_score_alert');\n      if (score > 80) automationsTriggered.push('assign_to_sales_rep');\n      if (score > 85) automationsTriggered.push('update_lifecycle_stage');\n      if (score > 75)\n        automationsTriggered.push('zapier_qualified_lead_workflow');\n\n      const response = {\n        success: true,\n        contact_id: contactId,\n        previous_score: previousScore,\n        new_score: score,\n        score_change: scoreChange,\n        scoring_factors: factors,\n        updated_by: updated_by || 'api',\n        reason: reason || 'Manual update via API',\n        automations_triggered: automationsTriggered,\n        updated_at: new Date().toISOString(),\n      };\n\n      res.json(response);\n    } catch (error) {\n      res.status(500).json({\n        error: 'SCORE_UPDATE_FAILED',\n        message: error instanceof Error ? error.message : 'Error desconocido',\n        timestamp: new Date().toISOString(),\n      });\n    }\n  }\n);\n\n/**\n * @swagger\n * /hubspot/contacts/{contactId}:\n *   get:\n *     tags: [HubSpot]\n *     summary: Obtener informaci√≥n de un contacto\n *     description: |\n *       Obtiene informaci√≥n completa de un contacto espec√≠fico desde HubSpot.\n *\n *       **Informaci√≥n incluida:**\n *       - üë§ Datos b√°sicos del contacto\n *       - üìä Score actual y hist√≥rico\n *       - üè∑Ô∏è Tags y propiedades personalizadas\n *       - üìà Historial de interacciones\n *       - üíº Informaci√≥n de empresa asociada\n *       - üîÑ Estado en pipelines de ventas\n *     security:\n *       - hubspotAuth: []\n *     parameters:\n *       - in: path\n *         name: contactId\n *         required: true\n *         schema:\n *           type: string\n *         description: ID √∫nico del contacto en HubSpot\n *         example: \"12345678901\"\n *       - in: query\n *         name: include\n *         schema:\n *           type: array\n *           items:\n *             type: string\n *             enum: [score_history, interactions, company, deals]\n *         description: Informaci√≥n adicional a incluir\n *         example: [\"score_history\", \"company\"]\n *     responses:\n *       200:\n *         description: Informaci√≥n del contacto obtenida exitosamente\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 success:\n *                   type: boolean\n *                 contact:\n *                   allOf:\n *                     - $ref: '#/components/schemas/HubSpotContact'\n *                     - type: object\n *                       properties:\n *                         id: { type: string }\n *                         created_at: { type: string }\n *                         updated_at: { type: string }\n *                         score_history:\n *                           type: array\n *                           items:\n *                             type: object\n *                             properties:\n *                               score: { type: integer }\n *                               timestamp: { type: string }\n *                               reason: { type: string }\n *                         recent_interactions:\n *                           type: array\n *                           items:\n *                             type: object\n *                             properties:\n *                               type: { type: string }\n *                               timestamp: { type: string }\n *                               details: { type: object }\n *             example:\n *               success: true\n *               contact:\n *                 id: \"12345678901\"\n *                 email: \"juan.perez@acme.com\"\n *                 firstname: \"Juan\"\n *                 lastname: \"P√©rez\"\n *                 phone: \"+34 600 123 456\"\n *                 company: \"Acme Corp\"\n *                 lead_score: 85\n *                 source: \"Website Form\"\n *                 created_at: \"2024-06-25T10:30:00.000Z\"\n *                 updated_at: \"2024-06-29T18:00:00.000Z\"\n *                 score_history:\n *                   - score: 45\n *                     timestamp: \"2024-06-25T10:30:00.000Z\"\n *                     reason: \"Initial form submission\"\n *                   - score: 85\n *                     timestamp: \"2024-06-29T18:00:00.000Z\"\n *                     reason: \"Downloaded whitepaper\"\n *                 recent_interactions:\n *                   - type: \"form_submission\"\n *                     timestamp: \"2024-06-25T10:30:00.000Z\"\n *                     details:\n *                       form_name: \"Contact Form\"\n *                       page_url: \"/contact\"\n *       401:\n *         $ref: '#/components/responses/Unauthorized'\n *       404:\n *         $ref: '#/components/responses/NotFound'\n *       500:\n *         $ref: '#/components/responses/InternalError'\n */\nrouter.get(\n  '/contacts/:contactId',\n  async (req: Request, res: Response): Promise<void> => {\n    try {\n      const { contactId } = req.params;\n      const { include = [] } = req.query;\n\n      if (!contactId) {\n        res.status(400).json({\n          error: 'MISSING_CONTACT_ID',\n          message: 'ID de contacto requerido',\n        });\n        return;\n      }\n\n      // Mock response - En producci√≥n aqu√≠ ir√≠a la integraci√≥n real con HubSpot\n      const contact = {\n        id: contactId,\n        email: 'juan.perez@acme.com',\n        firstname: 'Juan',\n        lastname: 'P√©rez',\n        phone: '+34 600 123 456',\n        company: 'Acme Corp',\n        lead_score: 85,\n        source: 'Website Form',\n        created_at: '2024-06-25T10:30:00.000Z',\n        updated_at: new Date().toISOString(),\n      };\n\n      // A√±adir informaci√≥n adicional seg√∫n par√°metros include\n      const response: any = { success: true, contact };\n\n      if (Array.isArray(include) && include.includes('score_history')) {\n        response.contact.score_history = [\n          {\n            score: 45,\n            timestamp: '2024-06-25T10:30:00.000Z',\n            reason: 'Initial form submission',\n          },\n          {\n            score: 85,\n            timestamp: new Date().toISOString(),\n            reason: 'Downloaded whitepaper',\n          },\n        ];\n      }\n\n      if (Array.isArray(include) && include.includes('interactions')) {\n        response.contact.recent_interactions = [\n          {\n            type: 'form_submission',\n            timestamp: '2024-06-25T10:30:00.000Z',\n            details: {\n              form_name: 'Contact Form',\n              page_url: '/contact',\n            },\n          },\n        ];\n      }\n\n      res.json(response);\n    } catch (error) {\n      res.status(500).json({\n        error: 'CONTACT_FETCH_FAILED',\n        message: error instanceof Error ? error.message : 'Error desconocido',\n        timestamp: new Date().toISOString(),\n      });\n    }\n  }\n);\n\nexport default router;\n"],"version":3}